<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./bootstrap.css" />
    <script src="./jquery.js"></script>
    <style>
      body {
        margin: 40px;
      }
      .sub {
        width: 200px;
        position: relative;
        left: 50%;
        transform: translate(-50%, 0);
      }
    </style>
  </head>
  <body>
    <form id="form2">
      <div class="form-group">
        <label for="exampleInputEmail1">username</label>
        <input type="text" class="form-control ipt" />
      </div>
      <div class="form-group">
        <label for="exampleInputPassword1">Password</label>
        <input
          type="password"
          class="form-control pwd"
          id="exampleInputPassword1"
        />
      </div>
      <button class="btn btn-primary sub">注册</button>
    </form>
  </body>
  <script>
    $(function () {
      let count = 2;
      console.log(count);
      $("#form2").on("submit", function (e) {
        e.preventDefault();
        console.log(1);
        // console.log($(".ipt").val);
        // console.log();
        if ($(".ipt").val() === "" || $(".pwd").val() === "") {
          return alert("请输入您要注册的账号和密码");
        }
        $.post(
          "http://127.0.0.1/api/register",
          {
            username: $(".ipt").val(),
            pwd: $(".pwd").val(),
          },
          function (res) {
            console.log(res);
            if (res.status === 200) {
              $("body").html("");
              let timer = setInterval(function () {
                if (count >= 0) {
                  $("body").html("");
                  document.write(
                    "注册成功！" + count + "秒后自动跳转到登录页面"
                  );
                  count--;
                } else {
                  location.href = "./testLogin.html";
                  return false;
                }
              }, 1000);
            } else {
              alert(res.msg);
            }
          }
        );
      });
    });
  </script>
</html>
